---
title: 데이터베이스 언어 뷰
tags: 데이터베이스 도서
article_header:
type: cover
---
# [1] 데이터베이스

---

<br><br>

**뷰(View)** 는 다른 테이블을 기반으로 만들어진 **가상 테이블**이다.

### 그럼 가상 테이블 이란 무엇일까?

> 가상 테이블이란 일반 테이블과 달리 데이터를 실제로 저장하고 있지 않는 테이블이다.

즉 **뷰**는 논리적으로만 존재하며 실제로 데이터를 저장하고 있지 않다는 특징이 있지만, 일반 테이블과 사용법이 같기 때문에 사용자는 차이를 느끼기 어렵다는 특징이 있다.


<br>

뷰를 생성 할 수 있는 재료에는 두가지가 있다.

* 첫번쨰는, 물리적인 **테이블**이다.

* 두번쨰는, 이미 만들어져있는 **뷰**를 통해서도 새로운 **뷰**를 생성할 수 있다.

<br><br>

## 1-1 뷰의 생성

---

뷰를 생성하기 위한 명령어는 **CREATE VIEW**이다.

기본적인 예시는 아래와 같다.

````
CREATE VIEW 뷰이름[(속성리스트)]
AS
SELECT 문
[WITH CHECK OPTION];
````

CREATE VIEW 명령어와 새로 생성할 뷰의 이름을 제시한 후, 뷰를 구성하는 속성의 이름을 괄호 안에 나열한다. 그리고 AS 키워드와 함께 기본테이블에 대한 SELECT
문을 제시한다. 여기서 SELECT문은 생성하고자 하는 뷰의 정의를 담고 있는데, ORDER BY를 사용할 수 없다.

또한 **WITH CHECK OPTION**을 넣을 수도 있는데 생성한 뷰에 삽입혹은 수정 연산을 할 때 SELECT 문에서 WHERE 키워드와 함께 제시한 뷰의 정의 조건을 위반하면 수행되지 않도록
하는 제약조건을 의미한다.

<br><br>

아래 예시를 들어 뷰를 생성해보겠다.

> 고객 테이블에서 등급이 VIP 인 고객의 고객아이디, 고객이름, 나이, 등급으로 구성된 뷰를 우수고객 이라는 이름으로 생성해보자. 그런 다음 우수고객 뷰의 모든 내용을 검색해보자.

<br>

````sql
CREATE VIEW 우수고객
AS
SELECT 고객아이디, 고객이름, 나이, 등급
FROM 고객
WHERE 등급 = 'VIP';

SELECT *
FROM 우수고객;
````

위와같은 형태로 VIEW를 생성하고 검색을 수행할 수 있다.

<br><br>

## 1-2 뷰의 활용

---

생성된 뷰는 일반적인 테이블과 같이 검색을 수행할 수 있다.

### 예제

> 우수고객 뷰에서 나이가 20세 이상인 고객에 대한 모든 내용을 검색해보자.

````sql
SELECT *
FROM 우수고객
WHERE AGE >= 20;
````

<br>

뷰는 INSERT, UPDATE, DELETE 문도 수행할 수 있다. 물론 뷰에 대한 삽입, 수정, 삭제, 연산도 기본 테이블에 수행되기 떄문에 결과적으로 **기본 테이블** 이변한다.

<br>

### 뷰에 데이터 값을 넣기 위해서는 조건이 필요하다.

---

뷰에 INSERT를 수행하기 위해서는 기존 테이블에 기본키 속성을 뷰가 가지고 있어야 한다.

### 왜그런것일까?

아래 예시를 하나보자

<br><br>

````sql
CREATE VIEW 제품2
AS
SELECT 제품명, 재고량, 제조업체
FROM 제품
WITH CHECK OPTION;

SELECT *
FROM 제품2;
````

이렇게 뷰를 생성하면 아래오같은 뷰가 생성될것이다.

<br><br>

|     | 제품명   | 재고량  | 제조업체 |
|-----|-------|------|------|
| 1   | 그냥만두  | 5000 | 대한식품 |
| 2   | 매운쫄면  | 2500 | 민국푸드 |
| 3   | 쿵떡파이  | 3600 | 한빛제과 |
| 4   | 맛난초콜릿 | 1250 | 한빛제과 |
| 5   | 얼큰라면  | 2200 | 대한식품 |
| 6   | 통통우동  | 1000 | 민국푸드 |
| 7   | 달콤비스킷 | 1650 | 한빛제과 |

이제 우리는 위의 뷰에 하나의 row를 추가해볼 것이다

````sql
INSERT INTO 제품2
VALUES ('시원냉면', 1000, '신석식품');
````

이렇게 8번째 로우에 값을 추가할 수 있을까?

답은 **그럴수 없다**이다.

<br>

### 왤까?

아래의 뷰에 값을 넣은 모습을 보자

<br><br>

| 제품번호 | 제품명   | 재고량  | 단가   | 제조업체 |
|------|-------|------|------|------|
| p01  | 그냥만두  | 5000 | 4500 | 대한식품 |
| p02  | 매운쫄면  | 2500 | 5600 | 민국푸드 |
| p03  | 쿵떡파이  | 3600 | 2600 | 한빛제과 |
| p04  | 맛난초콜릿 | 1250 | 2500 | 한빛제과 |
| p05  | 얼큰라면  | 2200 | 1200 | 대한식품 |
| p06  | 통통우동  | 1000 | 1550 | 민국푸드 |
| p07  | 달콤비스킷 | 1500 | 1500 | 한빛제과 |
| null | 시원냉면  | 1000 | null | 신선식품 |

<br><br>

>뷰에서 INSERT는 물리적인 테이블에 값을 추가하는 것이라고 했다.
>
>그렇다면 기존 제품 테이블에 8번째 행에 다음과 같이 값이 추가될것이다.
> 제품2 뷰는 제품명 제고량 제조업체를 가지고 있고 기존 테이블에 넣게 되면 **제품번호** 와 **단가**는 null로 처리될것이다.

>문제는 바로 이부분인데, 제품번호는 PK이고 PK이가 NULL로 처리된것이다. 이러한 문제떄문에 뷰는 기본키를 가지고 있지 않다면 INSERT를 할수없다.

<br><br>

뷰를 변경하는 (CUD)기능이 불가능한 경우에 대해서 보았는데, 이와는 다른 변경이 불가능한 경우가 몇가지 더있다.

## 1-3 변경 불가는한 뷰 특징

---

1. 기본키를 가지고 있지 않은 경우 혹은 기본 테이블에서 **NOT NULL**로 선언되어 있지만 뷰에서 그 속성을 가지고 있지 않은 경우 뷰
2. 기본테이블에 있던 내용이 아닌, **집계함수**로 새로 계산된 내용을 포함하고 있는 뷰
3. **DISTINCT** 키워드를 포함하여 정의한 뷰
4. **GROUP BY** 절을 포함하여 정의한 뷰
5. 여러개의 테이블을 **조인**하여 정의한 뷰

<br><br>

## 1-4 뷰의 장점

---

마지막으로 뷰를 사용하는 이유에 대해서 정리를 해보았다.

1. 질의문을 좀더 쉽게 작성할 수 있다.
> 특정 조건을 미리 뷰 형태로 만들어두면, 매번 WHERE을 사용하여 검색할 필요가 없다. 또한 GROUP BY나 집계함수 조인 등을 미리 뷰로 만들어두면 복잡한 SQL문을 매번 작성할 필요가없다.

2. 데이터 보안 유지에 도움이 된다.
> 여러 사용자의 요구에 맞는 뷰를 지정해두고 사용자가 자신에게 제공된 뷰를 통해서만 데이터에 접근하도록 권한을 부여하면, 뷰에 포함되지 않은 데이터를 보호할 수 있다.

3. 데이터를 좀 더 편리하게 관리할 수 있다.
> 제공된 뷰에 포함되지 않은 기본 테이블의 다른 부분은 사용자가 신경 쓸 필요가 없다.










































